@startuml UC05_Sequence
actor Student
boundary EnrollmentUI
control DropCourseController
entity EnrollmentRecord
entity WaitingList
boundary ApprovalUI
actor Staff

Student -> EnrollmentUI : 申请退课
activate EnrollmentUI
EnrollmentUI -> DropCourseController : requestDrop(sid, cid)
activate DropCourseController
alt Before Deadline
    DropCourseController -> EnrollmentRecord : removeRecord(sid, cid)
    DropCourseController -> WaitingList : popNext(cid)
    activate WaitingList
    WaitingList --> DropCourseController : nextSid
    deactivate WaitingList
    alt nextSid exists
        DropCourseController -> EnrollmentRecord : create(nextSid, cid)
    end
    DropCourseController --> EnrollmentUI : confirmDrop()
else After Deadline
    DropCourseController -> ApprovalUI : createRequest(sid, cid, reason)
    DropCourseController --> EnrollmentUI : notifyPendingApproval()
    ...
    Staff -> ApprovalUI : approveRequest(requestId)
    ApprovalUI -> DropCourseController : completeDrop(requestId)
end
deactivate DropCourseController
@enduml
